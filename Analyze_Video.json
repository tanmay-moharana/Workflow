{
  "name": "YouTube Gaming Shorts (Gemini)",
  "nodes": [
    {
      "id": "1",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [200, 300],
      "parameters": {
        "path": "yt-shorts",
        "method": "POST"
      }
    },
    {
      "id": "2",
      "name": "Download YouTube (yt-dlp)",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [400, 300],
      "parameters": {
        "command": "yt-dlp -o '/data/input.mp4' {{$json[\"body\"][\"url\"]}}"
      }
    },
    {
      "id": "3",
      "name": "Extract Audio (FFmpeg)",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [600, 300],
      "parameters": {
        "command": "ffmpeg -i /data/input.mp4 -vn -ar 44100 -ac 2 -b:a 192k /data/audio.mp3 -y"
      }
    },
    {
      "id": "4",
      "name": "Google Speech-to-Text",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [800, 300],
      "parameters": {
        "url": "https://speech.googleapis.com/v1/speech:recognize?key={{$env.GOOGLE_API_KEY}}",
        "method": "POST",
        "jsonParameters": true,
        "options": {},
        "body": {
          "config": {
            "encoding": "MP3",
            "languageCode": "en-US",
            "enableWordTimeOffsets": true
          },
          "audio": {
            "content": "={{$binary.data.toString('base64')}}"
          }
        }
      }
    },
    {
      "id": "5",
      "name": "Gemini: Find Best Clips",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [1000, 300],
      "parameters": {
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key={{$env.GOOGLE_API_KEY}}",
        "method": "POST",
        "jsonParameters": true,
        "body": {
          "contents": [
            {
              "parts": [
                {
                  "text": "Here is a transcript of a gaming video with timestamps. Suggest 2-3 short highlight clips (epic wins, funny fails, rage quits). Return JSON only: [{\"start\":\"00:12\",\"end\":\"00:25\",\"reason\":\"funny fail\"}, {\"start\":\"01:05\",\"end\":\"01:20\",\"reason\":\"epic win\"}]. Transcript: {{$json[\"results\"]}}"
                }
              ]
            }
          ]
        }
      }
    },
    {
      "id": "6",
      "name": "FFmpeg: Cut Clips",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [1200, 300],
      "parameters": {
        "command": "ffmpeg -i /data/input.mp4 -ss {{ $json[\"start\"] }} -to {{ $json[\"end\"] }} -vf \"scale=1080:1920:force_original_aspect_ratio=decrease,pad=1080:1920:(ow-iw)/2:(oh-ih)/2\" -c:a copy /data/clip_{{ $json[\"reason\"] }}.mp4 -y"
      }
    },
    {
      "id": "7",
      "name": "Gemini: Title & Description",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [1400, 300],
      "parameters": {
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key={{$env.GOOGLE_API_KEY}}",
        "method": "POST",
        "jsonParameters": true,
        "body": {
          "contents": [
            {
              "parts": [
                {
                  "text": "Generate a catchy YouTube Shorts title and description for this gaming highlight: {{$json[\"reason\"]}}"
                }
              ]
            }
          ]
        }
      }
    },
    {
      "id": "8",
      "name": "Upload to YouTube Shorts",
      "type": "n8n-nodes-base.googleYouTube",
      "typeVersion": 1,
      "position": [1600, 300],
      "parameters": {
        "resource": "video",
        "operation": "upload",
        "title": "={{$json[\"title\"]}}",
        "description": "={{$json[\"description\"]}}",
        "tags": ["gaming", "shorts"],
        "categoryId": "20",
        "privacyStatus": "public",
        "binaryProperty": "data"
      },
      "credentials": {
        "googleApi": "YouTube OAuth2"
      }
    }
  ],
  "connections": {
    "1": { "main": [[{ "node": "Download YouTube (yt-dlp)", "type": "main", "index": 0 }]] },
    "2": { "main": [[{ "node": "Extract Audio (FFmpeg)", "type": "main", "index": 0 }]] },
    "3": { "main": [[{ "node": "Google Speech-to-Text", "type": "main", "index": 0 }]] },
    "4": { "main": [[{ "node": "Gemini: Find Best Clips", "type": "main", "index": 0 }]] },
    "5": { "main": [[{ "node": "FFmpeg: Cut Clips", "type": "main", "index": 0 }]] },
    "6": { "main": [[{ "node": "Gemini: Title & Description", "type": "main", "index": 0 }]] },
    "7": { "main": [[{ "node": "Upload to YouTube Shorts", "type": "main", "index": 0 }]] }
  }
}
