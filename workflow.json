{
  "name": "PS5 Highlight â†’ Shorts + GCS",
  "nodes": [
    {
      "parameters": {
        "functionCode": "return [{ json: { channelId: \"UCqKZx0XQEFg6OD79XEfiERg\" } }];"
      },
      "name": "Set Channel ID",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [200, 300]
    },
    {
      "parameters": {
        "resource": "video",
        "operation": "list",
        "part": "snippet,contentDetails",
        "maxResults": 1,
        "order": "date",
        "filters": {
          "channelId": "={{$json[\"channelId\"]}}"
        }
      },
      "name": "Get Latest PS5 Video",
      "type": "n8n-nodes-base.youtube",
      "typeVersion": 1,
      "position": [450, 300],
      "credentials": {
        "youtubeOAuth2": "YOUR_YOUTUBE_OAUTH"
      }
    },
    {
      "parameters": {
        "command": "yt-dlp -f 'best[height<=480]' -o /tmp/video_low.mp4 {{$json[\"id\"][\"videoId\"]}}"
      },
      "name": "Download Low-res for Analysis",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [700, 300]
    },
    {
      "parameters": {
        "url": "https://videointelligence.googleapis.com/v1/videos:annotate",
        "authentication": "serviceAccount",
        "sendBody": true,
        "jsonParameters": true,
        "options": {},
        "body": {
          "inputUri": "gs://YOUR_TEMP_BUCKET/video_low.mp4",
          "features": ["SHOT_CHANGE_DETECTION"]
        }
      },
      "name": "GCP Scene Detection",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [950, 300],
      "credentials": {
        "googleApi": {
          "serviceAccountEmail": "YOUR_SERVICE_ACCOUNT_EMAIL",
          "privateKey": "YOUR_PRIVATE_KEY"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "const shots = $json.annotationResults[0].shotAnnotations;\nlet longest = {duration:0};\nfor(const s of shots){\n  const start = (s.startTimeOffset.seconds||0) + (s.startTimeOffset.nanos||0)/1e9;\n  const end = (s.endTimeOffset.seconds||0) + (s.endTimeOffset.nanos||0)/1e9;\n  const dur = end-start;\n  if(dur>longest.duration) longest={start,end,duration:dur};\n}\nreturn [{json: longest}];"
      },
      "name": "Pick Longest Scene",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1200, 300]
    },
    {
      "parameters": {
        "command": "yt-dlp -f 'bestvideo+bestaudio' -o /tmp/video_full.mp4 {{$json[\"id\"][\"videoId\"]}} && ffmpeg -i /tmp/video_full.mp4 -ss {{$json[\"start\"]}} -to {{$json[\"end\"]}} -vf \"scale=1080:1920,setsar=1:1\" -c:v libx264 -c:a aac /tmp/short.mp4"
      },
      "name": "Download Full-res & Clip",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [1450, 300]
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "url": "https://storage.googleapis.com/upload/storage/v1/b/YOUR_BUCKET_NAME/o?uploadType=media&name=shorts/{{$json[\"id\"][\"videoId\"]}}.mp4",
        "sendBinaryData": true,
        "binaryPropertyName": "data"
      },
      "name": "Upload to GCS Bucket",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [1700, 150],
      "credentials": {
        "googleApi": {
          "serviceAccountEmail": "YOUR_SERVICE_ACCOUNT_EMAIL",
          "privateKey": "YOUR_PRIVATE_KEY"
        }
      }
    },
    {
      "parameters": {
        "videoPath": "/tmp/short.mp4",
        "title": "PS5 Highlight",
        "description": "Auto-clipped PS5 highlight.",
        "tags": ["PS5","Gaming","Shorts"],
        "privacyStatus": "public"
      },
      "name": "Upload to YouTube Shorts",
      "type": "n8n-nodes-base.youtube",
      "typeVersion": 1,
      "position": [1700, 450],
      "credentials": {
        "youtubeOAuth2": "YOUR_YOUTUBE_OAUTH"
      }
    },
    {
      "parameters": {
        "command": "rm -f /tmp/video_low.mp4 /tmp/video_full.mp4 /tmp/short.mp4"
      },
      "name": "Cleanup Temp Files",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [1950, 300]
    }
  ],
  "connections": {
    "Set Channel ID": { "main": [[{"node":"Get Latest PS5 Video","type":"main","index":0}]] },
    "Get Latest PS5 Video": { "main": [[{"node":"Download Low-res for Analysis","type":"main","index":0}]] },
    "Download Low-res for Analysis": { "main": [[{"node":"GCP Scene Detection","type":"main","index":0}]] },
    "GCP Scene Detection": { "main": [[{"node":"Pick Longest Scene","type":"main","index":0}]] },
    "Pick Longest Scene": { "main": [[{"node":"Download Full-res & Clip","type":"main","index":0}]] },
    "Download Full-res & Clip": { "main": [
      [{"node":"Upload to GCS Bucket","type":"main","index":0}],
      [{"node":"Upload to YouTube Shorts","type":"main","index":0}]
    ]},
    "Upload to GCS Bucket": { "main": [[{"node":"Cleanup Temp Files","type":"main","index":0}]] },
    "Upload to YouTube Shorts": { "main": [[{"node":"Cleanup Temp Files","type":"main","index":0}]] }
  }
}
